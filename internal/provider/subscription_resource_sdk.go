// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	"github.com/gravitee-io/terraform-provider-apim/internal/provider/customtypes"
	"github.com/gravitee-io/terraform-provider-apim/internal/provider/typeconvert"
	"github.com/gravitee-io/terraform-provider-apim/internal/sdk/models/operations"
	"github.com/gravitee-io/terraform-provider-apim/internal/sdk/models/shared"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"time"
)

func (r *SubscriptionResourceModel) RefreshFromSharedSubscriptionState(ctx context.Context, resp *shared.SubscriptionState) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		r.APIHrid = types.StringPointerValue(resp.APIHrid)
		r.ApplicationHrid = types.StringValue(resp.ApplicationHrid)
		endingAtValuable, endingAtDiags := customtypes.RFC3339Type{}.ValueFromString(ctx, types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.EndingAt)))
		diags.Append(endingAtDiags...)
		r.EndingAt = endingAtValuable.(customtypes.RFC3339)
		r.EnvironmentID = types.StringPointerValue(resp.EnvironmentID)
		r.Hrid = types.StringValue(resp.Hrid)
		r.ID = types.StringPointerValue(resp.ID)
		r.OrganizationID = types.StringPointerValue(resp.OrganizationID)
		r.PlanHrid = types.StringValue(resp.PlanHrid)
		r.StartingAt = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.StartingAt))
	}

	return diags
}

func (r *SubscriptionResourceModel) ToOperationsCreateOrUpdateAPISubscriptionsRequest(ctx context.Context) (*operations.CreateOrUpdateAPISubscriptionsRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	organizationID := new(string)
	if !r.OrganizationID.IsUnknown() && !r.OrganizationID.IsNull() {
		*organizationID = r.OrganizationID.ValueString()
	} else {
		organizationID = nil
	}
	environmentID := new(string)
	if !r.EnvironmentID.IsUnknown() && !r.EnvironmentID.IsNull() {
		*environmentID = r.EnvironmentID.ValueString()
	} else {
		environmentID = nil
	}
	var apiHrid string
	apiHrid = r.APIHrid.ValueString()

	subscriptionSpec, subscriptionSpecDiags := r.ToSharedSubscriptionSpec(ctx)
	diags.Append(subscriptionSpecDiags...)

	if diags.HasError() {
		return nil, diags
	}

	out := operations.CreateOrUpdateAPISubscriptionsRequest{
		OrganizationID:   organizationID,
		EnvironmentID:    environmentID,
		APIHrid:          apiHrid,
		SubscriptionSpec: *subscriptionSpec,
	}

	return &out, diags
}

func (r *SubscriptionResourceModel) ToOperationsDeleteAPISubscriptionRequest(ctx context.Context) (*operations.DeleteAPISubscriptionRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	organizationID := new(string)
	if !r.OrganizationID.IsUnknown() && !r.OrganizationID.IsNull() {
		*organizationID = r.OrganizationID.ValueString()
	} else {
		organizationID = nil
	}
	environmentID := new(string)
	if !r.EnvironmentID.IsUnknown() && !r.EnvironmentID.IsNull() {
		*environmentID = r.EnvironmentID.ValueString()
	} else {
		environmentID = nil
	}
	var apiHrid string
	apiHrid = r.APIHrid.ValueString()

	var hrid string
	hrid = r.Hrid.ValueString()

	out := operations.DeleteAPISubscriptionRequest{
		OrganizationID: organizationID,
		EnvironmentID:  environmentID,
		APIHrid:        apiHrid,
		Hrid:           hrid,
	}

	return &out, diags
}

func (r *SubscriptionResourceModel) ToOperationsGetAPISubscriptionRequest(ctx context.Context) (*operations.GetAPISubscriptionRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	organizationID := new(string)
	if !r.OrganizationID.IsUnknown() && !r.OrganizationID.IsNull() {
		*organizationID = r.OrganizationID.ValueString()
	} else {
		organizationID = nil
	}
	environmentID := new(string)
	if !r.EnvironmentID.IsUnknown() && !r.EnvironmentID.IsNull() {
		*environmentID = r.EnvironmentID.ValueString()
	} else {
		environmentID = nil
	}
	var apiHrid string
	apiHrid = r.APIHrid.ValueString()

	var hrid string
	hrid = r.Hrid.ValueString()

	out := operations.GetAPISubscriptionRequest{
		OrganizationID: organizationID,
		EnvironmentID:  environmentID,
		APIHrid:        apiHrid,
		Hrid:           hrid,
	}

	return &out, diags
}

func (r *SubscriptionResourceModel) ToSharedSubscriptionSpec(ctx context.Context) (*shared.SubscriptionSpec, diag.Diagnostics) {
	var diags diag.Diagnostics

	var hrid string
	hrid = r.Hrid.ValueString()

	var applicationHrid string
	applicationHrid = r.ApplicationHrid.ValueString()

	var planHrid string
	planHrid = r.PlanHrid.ValueString()

	endingAt := new(time.Time)
	if !r.EndingAt.IsUnknown() && !r.EndingAt.IsNull() {
		*endingAt, _ = time.Parse(time.RFC3339Nano, r.EndingAt.ValueString())
	} else {
		endingAt = nil
	}
	out := shared.SubscriptionSpec{
		Hrid:            hrid,
		ApplicationHrid: applicationHrid,
		PlanHrid:        planHrid,
		EndingAt:        endingAt,
	}

	return &out, diags
}
